# 分享标题
大家好，几天给大家带来的分享是 从矩阵走入 WebGL 世界。

# 自我介绍
嗯，大家可能不认识我，我叫陈剑鑫，大家可以叫我jason，也可以叫我JC，
是一名来自UC的前端开发工程师，
现在是主要负责活动营销方面的业务，对的，像那些朋友圈里经常刷屏的小游戏、酷炫的视觉效果，我们是做类似这样的项目的
沉迷于可编程动画、webgl等图形技术等前端开发。

# 矩阵有什么用
在我们开始接触矩阵之前，先来看看矩阵到底有什么用，给我们带来了什么
下面是我随意列举的几个项目的录屏，来感受下矩阵给项目带来的改变

1、是一个综艺类相关的节目，loading采用了一个氛围灯的效果。这个效果是纯canvas 2d原生api实现的，
代码体积也就只有3k的样子，想想看如果这里换成图片至少20k

2、这是一个项目的抽奖页面，但是大家在看到这样的一个抽奖页面是不是就会下意识的会对这个活动的更加信任，
活动的信誉度提高，就是感觉能抽到奖，通过这些细节提高自己项目的档次，这也是这类效果的优势。

3、这个是俄罗斯奥运会期间的一个活动，这个loading也是用纯canvas 2d原生api实现的，
也是根据一个轮廓样条生成这个模型的三维坐标点，然后进行相应的旋转，代码也很小3到4k。

这些效果的实现代码只有3到4K，像上面的任意一个这些效果如果你是选择其它方式来实现比如序列帧图片，
至少也要十几二十k吧，这么大的资源本身对页面就是一个负担，并且表现的张力远远没有程序实现来的要大。

# 矩阵
其实刚才那些效果都是通过矩阵来实现的，是不是感觉还是有一些小激动的，实现的效果还挺好玩。讲到矩阵，
可能有些人会感觉矩阵很陌生，我们不做营销活动业务，矩阵对我们来说完全用不到啊，没交集啊，挤地铁的时候用不到，逛淘宝的时候用不到。
其实啊矩阵和我们还是有很多交集的，大家在不经意间用到过她们，只不过是浏览器把它们封装的更简单了，你感觉不到你正在使用矩阵。
最常用的css3 transform
# css3 transform
transform和矩阵有着千丝万缕的联系，了解过的童鞋可能知道transform的各种变换效果在底层都是由matrix来实现的。
例如translate、rotate、scale、skew这些功能在底层都是有矩阵来实现的，
正因为底层是由矩阵实现的，所以transform 2d 给我们提供了直接传入一个矩阵的方法，matrix
我们知道除了css 2d，css3还带来了让我们兴奋不已的三维能力，其中最让我们激动（印象深刻）的就是transform三维变换里面的三维旋转功能了，
例如这下面的这个欢快的立方体。这里要多讲一点的是 数据里面描述一个物体在三维空间里面的旋转姿态一般有三种方法，
第一个不用说咯，就是矩阵咯，都说了这些东西最后都会用矩阵来实现嘛。还有一个就是欧拉角的形式，另一个是四元数的形式。
这两种描述相比于矩阵要更直观一些，欧拉角听起来好像很高大上的感觉，其实它对应的就是我们常用的rotateX｜Y｜Z系列，欧拉角的含义就是描述一个物体围绕自身的坐标轴旋转多少角度。
四元数这名字听起来不伦不类的，什么鬼，听到名字就不喜欢更它玩的感觉，其实四元数就大概可以对应到rotate3d，rotate3d大家用到的可能相对会比较少，网上有很多技术文章对他的解释都是有误的，
rotate3d接受四个参数嘛，很多文章说这四个参数前三个是0到1之间的数字，第四个参数是角度。这样说是错误的，或者说只说对了四分之一，因为rotate3d是基于四元数的一个变形，
他前面的三个参数实际上是一个方向向量，既然是方向向量就没有什么0到1之间的这么一说了对吧，任意有限的数值。浏览器在接收到rotate3d的参数后是先对传入的那个向量进行归一化，
然后再将角度除以2之后正弦余弦，这就不详细往下讲了哈，只要记住前面三个参数是一个向量就好了
除此之外还有svg里面也有矩阵的身影
canvas里面也有矩阵的身影

所以说矩阵和我们还是很熟的，并且矩阵在现代浏览器中非常重要。假如没有了矩阵你会感觉前端顿时变成了一个没有爱的世界

# 矩阵是什么
讲了这么久矩阵，还没看到矩阵到底长什么样的对吧，接下来我们来一步一步揭开矩阵的面纱
这就是矩阵，长得方方正正的，有点微胖。国字脸，不说了等下不要把它弄生气了。
根据刚才的实例我们也都知道了，他是用来描述几何空间内的放射变换的。

我们都知道用矩阵可以变换几何坐标点，但是矩阵到底是怎么做到这一点的呢。
我们主要是通过矩阵的乘法来使用矩阵的几何特性的，像第一个式子就是矩阵对坐标点变换的过程。
携带变换信息的矩阵乘以待变换的坐标点最后会得到变换之后的坐标点，大家应该还记得矩阵的乘法公式吧。
a行b列矩阵乘以b行c列最后会得到a行c列矩阵，有点绕口，脑回路走一走。
还有一个就是矩阵乘法不符合乘法交换律，其实这一个特性我们在开发的时候有遇到过。
下面这两个动画操作的函数是一样的，只是顺序不同，但是结构完全不一样。
这就是因为矩阵不符合乘法交换律

# 价值
有些同学可能会想，矩阵厉害是厉害，但是这些东西浏览器都帮我们处理好了，我们为什么还要花时间去学习了解矩阵呢。研究他的价值在哪里？
我想前面的几个实例就说明了它的价值，因为浏览器并没有给我门提供实现这种效果的api啊,所以为了实现超凡脱俗、有趣的效果，深入了解矩阵就很有必要了。
好了安利完了矩阵的价值，我们继续。
为了我们的对动画的信仰，我们进一步了解矩阵。
学什么都得从最简单的开始，就像我们以前学向量要先学单位向量一样，先来看看单位矩阵
对角线全为1，他有什么作用呢，看下面这个例子，我用transform的matrix3d方法把这个矩阵传给了这个红色的方块，
发现这个放开没有做任何变化，这也正和他的名字一样，单位嘛，就像单位向量乘以任何向量得到的还是那个向量。

这里我快速的列出了我们比较常见的矩阵门，由于时间关系我就不一一推导了哈，有兴趣的可以先下找我聊哈，我挑其中一个比较有代表性的快速推导一下，rotateZ
大家看看Z轴旋转矩阵的长相，
绕Z轴旋转，因为我们知道坐标点绕哪个轴旋转，那么坐标点的该轴的分量是保持不变，这是常识哈，那绕Z轴旋转就可以简化到x－y的二维笛卡尔坐标系上讨论了，
这样一来就很好推了，xy绕Z轴旋转β角度后到了x`y`，然后我们可以很快的得到这样一个式子

不难吧，看到大家都听懂了的样子好开心。

# 配合webgl使用矩阵
了解过webgl的人可能知道，要想玩原生webgl你首先要搞清楚几个东西，一个是矩阵（因为浏览器没有为webgl实现矩阵功能的封装，鼓励开发者自己实现）、
其次就是webgl的渲染流水线啦、了解了这些你就能玩起来了，只能说玩的起来。
其实搞懂了webgl的渲染流水线之后你会对浏览器的渲染过程很了解，可以解释一些奇怪的问题，比如有些时候你在使用一些可继承的特殊样式的时候会使得子级的3d效果失效，
简单的说就是因为目前浏览器的光栅化过程是在cpu上完成的，chrome有一个计划就是未来会把光栅化过程也放到gpu中，这样就可以充分的利用gpu在图形渲染方面的优势了。

通过位移矩阵来改变场景内的坐标点，再加上透视矩阵实现这种近大远小大效果。

webgl的原生操作会有点繁琐，没办法因为他是可编程渲染管线吗，事儿本来就多。

可能有些同学会想，这些效果炫是炫，但是不实用啊。那我们就来一个使用一点的。

# 更复杂的demo
刚才的例子都是单纯的利用矩阵来实现的效果，基本上没用到其他的知识点。但是即使光是使用矩阵，做出来的效果还是蛮好玩的。
下面来介绍下矩阵配合其它的图形学知识点来实现更复杂一点的效果。

# VR 
都说到了，webgl了，怎么能不聊聊今年这么火的AR呢，
来看看矩阵在AR上的应用，增强现实。
大部分比较完整的AR都有一个步骤就是从真实的世界图像里面表定照相机的姿态参数或者物体的姿态参数。
然后基于得到的这个视角的坐标姿态信息来重建虚拟的三维世界到世界图像中。
因为AR要动态的跟踪真是场景的变化来调整虚拟世界的姿态嘛，所以就需要图像内容的读取能力。

# VR 
讲了AR怎么能不讲VR呢，来看看矩阵在VR上的应用。
VR相比于AR，在技术组成上要多一些，真正的VR一般都包括头显、手柄、探测部件啊等。
这些东西的成本太高了，但是我门可以玩玩VR视觉。
这里是刚才的星空效果的VR版，戴上VR眼镜你可以四处观察，在转场运动的时候感受粒子向你扑来的效果。
由于时间关系，我门重点来体验一下这一个demo哈。
这里面开场的时候有一个非均匀有理B样条的使用，实现这种不同视角的平滑切换。然后配合手机的传感器来控制里面的那个小车。


为什么我们人可以感受到三维世界，是因为我们是用两个眼睛去观察的，可以做个实验，你用手遮住一个眼睛，用另外一个眼睛观察你身边的一个细物体，用你的一个手指去触碰它，你会感觉我快要触碰到它了啊，但是你再往前伸一点你才真正的碰到它，这就是因为你只用一个眼睛去观察它，丢失了一个维度的信息，让你对深度不敏感了。同理从屏幕里面出来的三维图像，在屏幕这个过程就已经丢失了一个维度的信息，所以，我们想要还原这个信息就应该，把丢失的这个维度找回来。


到这个时候是不是发现矩阵可以给你整个世界，还要什么自行车啊

# Q&A
随着这个demo，本次分享也接近尾声，大家有没有什么问题想问的啊？

# THX
最好谢谢大家。



